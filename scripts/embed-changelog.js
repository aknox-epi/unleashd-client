#!/usr/bin/env node

/**
 * Embed Changelog Script
 *
 * This script reads CHANGELOG.md and embeds it into constants/changelog.ts
 * so it can be imported and used in the app at runtime.
 *
 * Run: npm run update-changelog
 * Auto-runs: Before build (prebuild hook)
 */

const fs = require('fs');
const path = require('path');

const changelogPath = path.join(__dirname, '../CHANGELOG.md');
const outputPath = path.join(__dirname, '../constants/changelog.ts');

try {
  // Read CHANGELOG.md
  const changelogContent = fs.readFileSync(changelogPath, 'utf-8');

  // Generate TypeScript file
  const output = `/**
 * Embedded changelog content (auto-generated)
 * 
 * ⚠️ DO NOT EDIT THIS FILE MANUALLY ⚠️
 * 
 * This file is automatically generated from CHANGELOG.md
 * Run \`npm run update-changelog\` to regenerate
 * 
 * The changelog is embedded at build time to ensure the app
 * always shows the latest changes without needing to read files
 * at runtime (which doesn't work in production Expo builds).
 */
export const CHANGELOG_CONTENT = ${JSON.stringify(changelogContent)};
`;

  // Write to constants/changelog.ts
  fs.writeFileSync(outputPath, output, 'utf-8');

  console.log('✅ Changelog embedded successfully!');
  console.log(`   Source: CHANGELOG.md`);
  console.log(`   Output: constants/changelog.ts`);
  console.log(`   Size: ${changelogContent.length} characters`);
} catch (error) {
  console.error('❌ Failed to embed changelog:', error.message);
  process.exit(1);
}
